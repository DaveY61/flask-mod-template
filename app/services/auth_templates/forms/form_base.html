{% extends 'layouts/form.html' %}

{% block title %}{{ purpose }}{% endblock %}

{% block content %}
  <form method="post" class="form" id="auth-form">
    <h3 class="form-heading d-flex justify-content-between align-items-center mb-4">
      {{ purpose }} 
      <a href="{{ url_for('home') }}" title="Back to homepage" class="ms-auto">
        <i class="fa-solid fa-house fa-sm"></i>
      </a>
    </h3>
    
    {% block form_content %}
    <!-- This block will be overridden by specific forms -->
    {% endblock %}

    <button type="submit" class="btn btn-primary btn-lg w-100" id="submit-button">Submit</button>
    <div id="eula-warning" class="text-warning mt-2" style="display: none;">
      <i class="fas fa-exclamation-triangle"></i>
      Review and accept the EULA before submitting.
    </div>
  </form>
{% endblock %}

{% block additional_styles %}
<style>
  .form-heading {
    margin-bottom: 1rem;
  }
  .form-heading a {
    font-size: 0.8em;
  }
</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('auth-form');
    const submitButton = document.getElementById('submit-button');
    const warningElement = document.getElementById('eula-warning');
    const eulaCheckbox = document.getElementById('eula_acknowledged');

    function updateSubmitButton() {
        if (eulaCheckbox) {
            submitButton.disabled = !eulaCheckbox.checked;
            warningElement.style.display = eulaCheckbox.checked ? 'none' : 'block';
        }
    }

    if (eulaCheckbox) {
        eulaCheckbox.addEventListener('change', updateSubmitButton);
        updateSubmitButton(); // Initial state
    } else {
        // If there's no EULA checkbox, ensure the button is enabled and warning is hidden
        submitButton.disabled = false;
        warningElement.style.display = 'none';
    }

    form.addEventListener('submit', function(event) {
        if (eulaCheckbox && !eulaCheckbox.checked) {
            event.preventDefault();
            warningElement.style.display = 'block';
        }
    });
});
</script>
{% endblock %}